{"version":3,"sources":["webpack:///webpack/bootstrap 540a2ec908c64cd68703","webpack:///external \"mongoose\"","webpack:///./server/config.js","webpack:///external \"koa-router\"","webpack:///./server/index.js","webpack:///external \"koa\"","webpack:///external \"nuxt\"","webpack:///./server/mongodb/index.js","webpack:///./server/middlewares.js","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-json\"","webpack:///./server/routes/index.js","webpack:///./server/routes/api.js","webpack:///./server/routes/children/project.js","webpack:///./server/controllers/project.js","webpack:///external \"fs\"","webpack:///external \"simple-git/promise\"","webpack:///./server/const.js","webpack:///./server/mongodb/models/project.js","webpack:///./server/mongodb/schemas/project.js","webpack:///./server/controllers/base.js","webpack:///./nuxt.config.js","webpack:///external \"autoprefixer\""],"names":["app","name","version","server","port","static","root","options","mongodb","url","account","password","session","secretKey","host","process","env","HOST","PORT","config","isProd","nuxtConfig","require","dev","nuxt","builder","build","middlewares","use","router","routes","ctx","next","status","Promise","resolve","reject","res","on","render","req","promise","then","catch","listen","mongoose","connect","db","connection","err","console","log","once","headersSent","throw","body","data","type","message","emit","bodyParser","Router","api","allowedMethods","project","get","ProjectController","find","findOne","post","save","initRepo","git","remote","init","addRemote","findRepoBranch","inst","id","all","current","checkIsRepo","isRepo","branch","branchList","constructor","params","requestBody","request","_id","Project","findOneAndUpdate","new","upsert","remove","query","content","projects","filter","_","includes","map","number","total","size","totalElements","findBackUp","backup","date","backups","model","Schema","String","BaseController","module","exports","middleware","head","title","meta","charset","hid","link","rel","href","vendor","babel","plugins","libraryName","styleLibraryName","loaders","test","loader","limit","postcss","browsers","HOST_URL","loading","color","css","src","lang"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 540a2ec908c64cd68703","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","export default {\r\n  app: {\r\n    name: 'demo',\r\n    version: '1.0.0'\r\n  },\r\n  server: {\r\n    port: 3000\r\n  },\r\n  static: {\r\n    root: './static',\r\n    options: {}\r\n  },\r\n  mongodb: {\r\n    name: 'test',\r\n    url: 'mongodb://localhost:27017/test',\r\n    account: 'chris',\r\n    password: '123456'\r\n  },\r\n  session: {\r\n    secretKey: '123'\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/config.js","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 2\n// module chunks = 0","import Koa from 'koa'\r\nimport {Nuxt, Builder} from 'nuxt'\r\nimport './mongodb'\r\nimport config from './config'\r\nimport middlewares from './middlewares'\r\nimport router from './routes'\r\n\r\nconst app = new Koa()\r\n\r\nconst host = process.env.HOST || '127.0.0.1'\r\nconst port = process.env.PORT || config.server.port\r\nconst isProd = process.env.NODE_ENV === 'production'\r\n\r\nlet nuxtConfig = require('../nuxt.config')\r\nnuxtConfig.dev = !(app.env === 'production')\r\n\r\nconst nuxt = new Nuxt(nuxtConfig)\r\n\r\nif (nuxtConfig.dev) {\r\n  const builder = new Builder(nuxt)\r\n  builder.build()\r\n}\r\n\r\nmiddlewares(app)\r\napp.use(router.routes())\r\napp.use(async (ctx, next) => {\r\n  ctx.status = 200\r\n  return new Promise((resolve, reject) => {\r\n    ctx.res.on('close', resolve)\r\n    ctx.res.on('finish', resolve)\r\n    nuxt.render(ctx.req, ctx.res, promise => {\r\n      promise.then(resolve).catch(reject)\r\n    })\r\n  })\r\n})\r\napp.listen(port, host)\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 5\n// module chunks = 0","import mongoose from 'mongoose'\r\nimport config from '../config'\r\n\r\nmongoose.connect(config.mongodb.url)\r\nconst db = mongoose.connection\r\n\r\ndb.on('error', err => {\r\n  console.log('数据库连接失败：' + err)\r\n})\r\ndb.once('open', () => {\r\n  console.log('数据库连接成功')\r\n})\r\ndb.on('disconnected', () => {\r\n  console.log('数据哭连接断开')\r\n})\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/mongodb/index.js","import bodyParser from 'koa-bodyparser'\r\nimport json from 'koa-json'\r\nimport config from './config'\r\n\r\nexport default (app) => {\r\n  app.use(async (ctx, next) => {\r\n    try {\r\n      await next()\r\n      if (ctx.status === 404 && ctx.res.headersSent === false) {\r\n        ctx.throw(404)\r\n      }\r\n      if (ctx.status === 200 && ctx.res.headersSent === false) {\r\n        ctx.body = {\r\n          status: 200,\r\n          data: ctx.body\r\n        }\r\n      }\r\n    } catch (err) {\r\n      ctx.status = err.status || 500\r\n      ctx.type = 'json'\r\n      ctx.body = {\r\n        status: ctx.status,\r\n        message: err.message\r\n      }\r\n      ctx.app.emit('error', err, ctx)\r\n    }\r\n  })\r\n  app.use(bodyParser())\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares.js","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"koa-json\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-json\"\n// module id = 9\n// module chunks = 0","import Router from 'koa-router'\r\nimport api from './api'\r\nconst router = Router()\r\n\r\nrouter.use('/api', api.routes(), api.allowedMethods())\r\n\r\nexport default router\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/routes/index.js","import Router from 'koa-router'\r\nimport project from './children/project'\r\nconst router = Router()\r\n\r\nrouter.use('/project', project.routes(), project.allowedMethods())\r\n\r\nexport default router\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/routes/api.js","import Router from 'koa-router'\r\nimport ProjectController from '../../controllers/project'\r\nconst router = Router()\r\n\r\nrouter.get('/list', ProjectController.find)\r\nrouter.get('/get', ProjectController.findOne)\r\nrouter.post('/save', ProjectController.save)\r\n// router.get('/build', async (ctx, next) => {\r\n//   ctx.type = 'json'\r\n//   let {id} = ctx.query\r\n//   let message\r\n//   const project = projects.find(_ => _.id === id)\r\n//   try {\r\n//     const inst = git(`./projects/${project.id}`)\r\n//     // init reposity\r\n//     await inst.checkIsRepo()\r\n//       .then(isRepo => !isRepo && initRepo(inst, project.url))\r\n//       .then(() => inst.fetch())\r\n//       // .then(() => inst.pull('origin', 'develop'))\r\n//     message = await inst.branch()\r\n//   }\r\n//   catch (e) {\r\n//     console.error('failed: ', e)\r\n//     message = 'error'\r\n//   }\r\n//   ctx.body = message\r\n// })\r\n\r\nexport default router\n\n\n// WEBPACK FOOTER //\n// ./server/routes/children/project.js","import fs from 'fs'\r\nimport git from 'simple-git/promise'\r\nimport {projects, backups} from '../const'\r\nimport Project from '../mongodb/models/project'\r\nimport BaseController from './base'\r\n\r\nconst initRepo = (git, remote) => git.init().then(() => git.addRemote('origin', remote))\r\nconst findRepoBranch = async project => {\r\n  const inst = git(`./projects/${project.id}`)\r\n  let {all, current} = await inst.checkIsRepo()\r\n    .then(isRepo => !isRepo && initRepo(inst, project.url))\r\n    .then(() => inst.branch())\r\n  return {\r\n    ...project,\r\n    current,\r\n    branchList: all\r\n  }\r\n}\r\n\r\nclass ProjectController extends BaseController {\r\n  constructor (params) {  \r\n    super(params)\r\n\r\n    this.name = params.name\r\n    this.url = params.url\r\n  }\r\n  // 保存项目信息\r\n  static async save(ctx, next) {\r\n    let requestBody = ctx.request.body\r\n    let {id: _id, name, url} = requestBody\r\n    let data = await Project.findOneAndUpdate({_id}, {name, url}, {new: true, upsert: true})\r\n    ctx.body = data\r\n  }\r\n  // 删除项目信息\r\n  static async remove(ctx, next) {\r\n    let {id: _id} = ctx.params\r\n    let res = await Project.remove({ _id })\r\n    ctx.body = res\r\n  }\r\n  // 获取项目信息\r\n  static async findOne(ctx, next) {\r\n    let {id: _id} = ctx.params\r\n    let res = await Project.findOne({_id})\r\n    ctx.body = res\r\n  }\r\n  // 获取项目列表\r\n  static async find(ctx, next) {\r\n    let {name = ''} = ctx.query\r\n    let res = await Project.find({name: `/${name}/`})\r\n    console.log(res)\r\n    let content = await Promise.all(projects.filter(_ => _.name.includes(name)).map(_ => findRepoBranch(_)))\r\n    ctx.body = {\r\n      content,\r\n      number: 1,\r\n      total: 1,\r\n      size: 10,\r\n      totalElements: 10\r\n    }\r\n  }\r\n  // 获取项目备份列表\r\n  static async findBackUp(ctx, next) {\r\n    ctx.body = {\r\n      content: backups,\r\n      number: 1,\r\n      total: 1,\r\n      size: 10,\r\n      totalElements: 10\r\n    }\r\n  }\r\n}\r\n\r\nexport default ProjectController\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/project.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"simple-git/promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"simple-git/promise\"\n// module id = 15\n// module chunks = 0","export const projects = [\r\n  {id: '1', name: 'tvi-trace-oa', url: 'https://gitee.com/tvi-center/tvi-trace-oa', backup: {id: '1', name: '2018-01-27', date: '2018-01-27'}},\r\n  {id: '2', name: 'tvi-trace-admin', url: 'https://gitee.com/tvi-center/tvi-trace-admin', backup: {id: '1', name: '2018-01-27', date: '2018-01-27'}}\r\n]\r\n\r\nexport const backups = [\r\n  {id: '1', name: '2018-01-27', date: '2018-01-27'},\r\n  {id: '2', name: '2018-01-28', date: '2018-01-28'}\r\n]\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/const.js","import mongoose from 'mongoose'\r\nimport ProjectSchema from '../schemas/project'\r\n\r\nconst Project = mongoose.model('Project', ProjectSchema)\r\n\r\nexport default Project\n\n\n// WEBPACK FOOTER //\n// ./server/mongodb/models/project.js","import mongoose from 'mongoose'\r\nconst Schema = mongoose.Schema\r\n\r\nconst Project = new Schema({\r\n\tname: {type: String},\r\n\turl: {type: String}\r\n})\r\n\r\nexport default Project\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/mongodb/schemas/project.js","class BaseController {\r\n\tconstructor ({id}) {\r\n    this.id = id\r\n\t}\r\n}\r\n\r\nexport default BaseController\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/base.js","module.exports = {\r\n  router: {\r\n    middleware: 'auth'\r\n  },\r\n  head: {\r\n    title: 'nuxt-element-demo',\r\n    meta: [\r\n      { charset: 'utf-8' },\r\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\r\n      { hid: 'description', name: 'description', content: 'Nuxt.js + element-ui DEMO' }\r\n    ],\r\n    link: [\r\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\r\n    ]\r\n  },\r\n  build: {\r\n    vendor: [\r\n      'element-ui', 'axios'\r\n    ],\r\n    babel: {\r\n      plugins: [\r\n        ['component', [{\r\n          libraryName: 'element-ui',\r\n          styleLibraryName: 'theme-chalk'\r\n        }]],\r\n        'transform-decorators-legacy'\r\n      ]\r\n    },\r\n    loaders: [\r\n      {\r\n        test: /\\.scss$/,\r\n        loaders: ['style', 'css', 'sass']\r\n      },\r\n      {\r\n        test: /\\.(png|jpe?g|gif|svg)$/,\r\n        loader: 'url-loader',\r\n        query: {\r\n          limit: 1000,\r\n          name: 'img/[name].[hash:7].[ext]'\r\n        }\r\n      },\r\n      {\r\n        test: /\\.(woff2?|eot|ttf|otf)(\\?.*)?$/,\r\n        loader: 'url-loader',\r\n        query: {\r\n          limit: 1000,\r\n          name: 'fonts/[name].[hash:7].[ext]'\r\n        }\r\n      }\r\n    ],\r\n    postcss: [\r\n      require('autoprefixer')({\r\n        browsers: ['last 3 versions']\r\n      })\r\n    ]\r\n  },\r\n  env: {\r\n    HOST_URL: process.env.HOST_URL || 'http://127.0.0.1:3000'\r\n  },\r\n  loading: { color: '#3B8070' },\r\n  css: [\r\n    'element-ui/lib/theme-chalk/index.css',\r\n    { src: '~assets/css/index.scss', lang: 'scss' },\r\n    { src: '~assets/css/reset.scss', lang: 'scss' }\r\n  ],\r\n  plugins: [\r\n    '~plugins/element-ui'\r\n  ]\r\n}\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","module.exports = require(\"autoprefixer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"autoprefixer\"\n// module id = 21\n// module chunks = 0"],"sourceRoot":""}